import{o as L,c as j,a as l,ai as ue,ak as ve,I as s,N as T,S as p,V as me,z as k,J as D,P as b,W as n,p as y,a0 as q,a1 as pe,a3 as ce,a5 as fe,a6 as ge,E as P,A as ye,al as N,am as we,a9 as Ce}from"./index-Br32wEr5.js";import{s as xe,a as oe,_ as be}from"./ConfirmDialog-BUrAGpmv.js";import{c as de,a as w,_ as m,s as Ve,b as $e}from"./ErrorMessage-BnvaTXJ-.js";import{C as Le}from"./CustomPagination-DtrH-UlE.js";import{c as F}from"./clients-CvXgLb6o.js";const he=["width","height"],_e={__name:"iconFile",props:{size:{type:Number,default:24}},setup(V){return(c,g)=>(L(),j("svg",{xmlns:"http://www.w3.org/2000/svg",width:V.size,height:V.size,viewBox:"0 0 12 12",fill:"none"},g[0]||(g[0]=[l("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M2.09467 1.34467C2.23532 1.20402 2.42609 1.125 2.625 1.125H7.125C7.22446 1.125 7.31984 1.16451 7.39016 1.23483L10.0152 3.85984C10.0855 3.93016 10.125 4.02554 10.125 4.125V10.125C10.125 10.3239 10.046 10.5147 9.90533 10.6553C9.76468 10.796 9.57391 10.875 9.375 10.875H2.625C2.42609 10.875 2.23532 10.796 2.09467 10.6553C1.95402 10.5147 1.875 10.3239 1.875 10.125V1.875C1.875 1.67609 1.95402 1.48532 2.09467 1.34467ZM6.96967 1.875L2.625 1.875L2.625 10.125H9.375V4.28033L6.96967 1.875Z",fill:"currentColor"},null,-1),l("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M7.125 1.125C7.33211 1.125 7.5 1.29289 7.5 1.5V3.75H9.75C9.95711 3.75 10.125 3.91789 10.125 4.125C10.125 4.33211 9.95711 4.5 9.75 4.5H7.125C6.91789 4.5 6.75 4.33211 6.75 4.125V1.5C6.75 1.29289 6.91789 1.125 7.125 1.125Z",fill:"currentColor"},null,-1),l("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M4.125 6.375C4.125 6.16789 4.29289 6 4.5 6H7.5C7.70711 6 7.875 6.16789 7.875 6.375C7.875 6.58211 7.70711 6.75 7.5 6.75H4.5C4.29289 6.75 4.125 6.58211 4.125 6.375Z",fill:"currentColor"},null,-1),l("path",{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M4.125 7.875C4.125 7.66789 4.29289 7.5 4.5 7.5H7.5C7.70711 7.5 7.875 7.66789 7.875 7.875C7.875 8.08211 7.70711 8.25 7.5 8.25H4.5C4.29289 8.25 4.125 8.08211 4.125 7.875Z",fill:"currentColor"},null,-1)]),8,he))}},Ne={class:"document-tag gap-2 flex"},De={class:"document-tag-icon flex items-center justify-center"},Se={class:"document-tag-name"},ze={__name:"DocumentTag",props:{firstName:String,cardType:{type:String,validator:V=>["residenceCard","driveLicense"].includes(V)}},setup(V){const c=V,g=ve(()=>{const C=c.cardType==="residenceCard"?"Residence Card":"License";return`${c.firstName}'s ${C}`});return(C,x)=>(L(),j("div",Ne,[l("div",De,[s(_e,{size:12})]),l("div",Se,T(g.value),1)]))}},re=ue(ze,[["__scopeId","data-v-106c6e68"]]),ke={class:"flex gap-1 my-5"},qe={class:"w-1/2"},Ie={class:"flex gap-1 my-5"},Ue={class:"w-1/2"},Ae={class:"flex gap-1 my-5"},He={class:"w-1/2"},Ee={class:"flex gap-1 my-5"},Me={class:"w-1/2"},Be={class:"flex gap-1 my-5"},Fe={class:"w-1/2"},Ze={class:"flex gap-1 my-5"},Pe={class:"w-1/2"},Te={class:"flex gap-1 my-5"},je={class:"w-1/2"},Re={class:"flex gap-1 my-5"},Je={class:"w-1/2"},Oe={class:"flex gap-1 my-5"},We={class:"w-1/2"},Ge={class:"flex gap-1 my-5"},Ke={class:"w-1/2"},Qe={class:"flex gap-1 my-5"},Xe={class:"w-1/2"},Ye={class:"flex gap-1 my-5"},el={class:"flex gap-1 my-5"},ll={class:"flex gap-1 my-5"},sl={class:"w-1/4"},al={class:"flex gap-2 justify-end mt-5 py-3"},tl={__name:"ClientDialog",props:{client:{type:Object,default:()=>({})},showDialog:Boolean},emits:["save","hide"],setup(V,{emit:c}){const g=c,C=p(!1),x=V,f={firstName:"",lastName:"",email:"",phone:"",addressLine1:"",addressLine2:"",city:"",country:"",state:"",zip:"",additional:"",residenceCard:"",driveLicense:"",points:0},i=p({...f}),S=p("Add new client"),I=de({firstName:w().required("First Name is required"),lastName:w().required("Last Name is required"),email:w().email("Invalid email").required("Email is required"),phone:w().required("Phone is required"),addressLine1:w().required("Address Line 1 is required"),addressLine2:w().optional(),city:w().required("City is required"),country:w().required("Country is required"),state:w().required("State is required"),zip:w().required("Zip is required"),additional:w().optional()}),H=()=>{i.value={...f},a.value={}},a=p({});me(()=>x.showDialog,v=>{S.value=x.client.id?"Edit client":"Add new client",i.value={...x.client},C.value=v});const u=async v=>{try{const e={[v]:i.value[v]};await de({[v]:I.fields[v]}).validate(e),delete a.value[v]}catch(e){a.value[v]=e.message}},Z=async()=>{try{a.value={},await I.validate(i.value,{abortEarly:!1}),g("save",i.value),z()}catch(v){v.inner&&v.inner.forEach(e=>{a.value[e.path]=e.message})}},z=()=>{H(),g("hide")},U=()=>{console.log("Uploaded")};return(v,e)=>(L(),k(n(Ve),{header:S.value,visible:C.value,"onUpdate:visible":[e[24]||(e[24]=h=>C.value=h),z],style:{width:"650px"},modal:!0},{default:D(()=>{var h,E,M,B,$,o,r,d,_,A,R,J,O,W,G,K,Q,X,Y,ee,le,se,ae,te,ie,ne;return[l("form",{onSubmit:pe(Z,["prevent"]),ref:"form"},[l("div",ke,[e[25]||(e[25]=l("div",{class:"flex items-start pt-3 w-1/2"},[l("label",{for:"firstName"},[b("First Name "),l("sup",{class:"text-red-600"},"*")])],-1)),l("div",qe,[s(n(y),{invalid:!!((h=a.value)!=null&&h.firstName),modelValue:i.value.firstName,"onUpdate:modelValue":e[0]||(e[0]=t=>i.value.firstName=t),onInput:e[1]||(e[1]=t=>u("firstName")),type:"text",id:"firstName",class:"w-full"},null,8,["invalid","modelValue"]),s(m,{message:(E=a.value)==null?void 0:E.firstName},null,8,["message"])])]),l("div",Ie,[e[26]||(e[26]=l("div",{class:"flex items-start pt-3 w-1/2"},[l("label",{for:"lastName"},[b("Last Name "),l("sup",{class:"text-red-600"},"*")])],-1)),l("div",Ue,[s(n(y),{invalid:!!((M=a.value)!=null&&M.lastName),modelValue:i.value.lastName,"onUpdate:modelValue":e[2]||(e[2]=t=>i.value.lastName=t),onInput:e[3]||(e[3]=t=>u("lastName")),type:"text",id:"lastName",class:"w-full"},null,8,["invalid","modelValue"]),s(m,{message:(B=a.value)==null?void 0:B.lastName},null,8,["message"])])]),l("div",Ae,[e[27]||(e[27]=l("div",{class:"flex items-start pt-3 w-1/2"},[l("label",{for:"email"},[b("Email "),l("sup",{class:"text-red-600"},"*")])],-1)),l("div",He,[s(n(y),{invalid:!!(($=a.value)!=null&&$.email),modelValue:i.value.email,"onUpdate:modelValue":e[4]||(e[4]=t=>i.value.email=t),onInput:e[5]||(e[5]=t=>u("email")),type:"email",id:"email",class:"w-full"},null,8,["invalid","modelValue"]),s(m,{message:(o=a.value)==null?void 0:o.email},null,8,["message"])])]),l("div",Ee,[e[28]||(e[28]=l("div",{class:"flex items-start pt-3 w-1/2"},[l("label",{for:"phone"},[b("Phone "),l("sup",{class:"text-red-600"},"*")])],-1)),l("div",Me,[s(n(y),{invalid:!!((r=a.value)!=null&&r.phone),modelValue:i.value.phone,"onUpdate:modelValue":e[6]||(e[6]=t=>i.value.phone=t),onInput:e[7]||(e[7]=t=>u("phone")),type:"text",id:"phone",class:"w-full"},null,8,["invalid","modelValue"]),s(m,{message:(d=a.value)==null?void 0:d.phone},null,8,["message"])])]),l("div",Be,[e[29]||(e[29]=l("div",{class:"flex items-start pt-3 w-1/2"},[l("label",{for:"addressLine1"},[b("Address Line 1 "),l("sup",{class:"text-red-600"},"*")])],-1)),l("div",Fe,[s(n(y),{invalid:!!((_=a.value)!=null&&_.addressLine1),modelValue:i.value.addressLine1,"onUpdate:modelValue":e[8]||(e[8]=t=>i.value.addressLine1=t),onInput:e[9]||(e[9]=t=>u("addressLine1")),type:"text",id:"addressLine1",class:"w-full"},null,8,["invalid","modelValue"]),s(m,{message:(A=a.value)==null?void 0:A.addressLine1},null,8,["message"])])]),l("div",Ze,[e[30]||(e[30]=l("div",{class:"flex items-start pt-3 w-1/2"},[l("label",{for:"addressLine2"},"Address Line 2")],-1)),l("div",Pe,[s(n(y),{invalid:!!((R=a.value)!=null&&R.addressLine2),modelValue:i.value.addressLine2,"onUpdate:modelValue":e[10]||(e[10]=t=>i.value.addressLine2=t),onInput:e[11]||(e[11]=t=>u("addressLine2")),type:"text",id:"addressLine2",class:"w-full"},null,8,["invalid","modelValue"]),s(m,{message:(J=a.value)==null?void 0:J.addressLine2},null,8,["message"])])]),l("div",Te,[e[31]||(e[31]=l("div",{class:"flex items-start pt-3 w-1/2"},[l("label",{for:"city"},[b("City "),l("sup",{class:"text-red-600"},"*")])],-1)),l("div",je,[s(n(y),{invalid:!!((O=a.value)!=null&&O.city),modelValue:i.value.city,"onUpdate:modelValue":e[12]||(e[12]=t=>i.value.city=t),onInput:e[13]||(e[13]=t=>u("city")),type:"text",id:"city",class:"w-full"},null,8,["invalid","modelValue"]),s(m,{message:(W=a.value)==null?void 0:W.city},null,8,["message"])])]),l("div",Re,[e[32]||(e[32]=l("div",{class:"flex items-start pt-3 w-1/2"},[l("label",{for:"country"},[b("Country "),l("sup",{class:"text-red-600"},"*")])],-1)),l("div",Je,[s(n(y),{invalid:!!((G=a.value)!=null&&G.country),modelValue:i.value.country,"onUpdate:modelValue":e[14]||(e[14]=t=>i.value.country=t),onInput:e[15]||(e[15]=t=>u("country")),type:"text",id:"country",class:"w-full"},null,8,["invalid","modelValue"]),s(m,{message:(K=a.value)==null?void 0:K.country},null,8,["message"])])]),l("div",Oe,[e[33]||(e[33]=l("div",{class:"flex items-start pt-3 w-1/2"},[l("label",{for:"state"},[b("State "),l("sup",{class:"text-red-600"},"*")])],-1)),l("div",We,[s(n(y),{invalid:!!((Q=a.value)!=null&&Q.state),modelValue:i.value.state,"onUpdate:modelValue":e[16]||(e[16]=t=>i.value.state=t),onInput:e[17]||(e[17]=t=>u("state")),type:"text",id:"state",class:"w-full"},null,8,["invalid","modelValue"]),s(m,{message:(X=a.value)==null?void 0:X.state},null,8,["message"])])]),l("div",Ge,[e[34]||(e[34]=l("div",{class:"flex items-start pt-3 w-1/2"},[l("label",{for:"zip"},[b("Zip "),l("sup",{class:"text-red-600"},"*")])],-1)),l("div",Ke,[s(n(y),{invalid:!!((Y=a.value)!=null&&Y.zip),modelValue:i.value.zip,"onUpdate:modelValue":e[18]||(e[18]=t=>i.value.zip=t),onInput:e[19]||(e[19]=t=>u("zip")),type:"text",id:"zip",class:"w-full"},null,8,["invalid","modelValue"]),s(m,{message:(ee=a.value)==null?void 0:ee.zip},null,8,["message"])])]),l("div",Qe,[e[35]||(e[35]=l("div",{class:"flex items-start pt-3 w-1/2"},[l("label",{for:"additional"},"Additional info")],-1)),l("div",Xe,[s(n(xe),{invalid:!!((le=a.value)!=null&&le.additional),modelValue:i.value.additional,"onUpdate:modelValue":e[20]||(e[20]=t=>i.value.additional=t),onInput:e[21]||(e[21]=t=>u("additional")),id:"additional",class:"w-full"},null,8,["invalid","modelValue"]),s(m,{message:(se=a.value)==null?void 0:se.additional},null,8,["message"])])]),l("div",Ye,[e[36]||(e[36]=l("div",{class:"flex items-start pt-3 w-1/2"},[l("label",{for:"residenceCard"},"Residence card")],-1)),l("div",null,[s(n(oe),{severity:"secondary",mode:"basic",name:"residenceCard[]",url:"/api/upload",accept:"image/*",maxFileSize:1e6,onUpload:U,auto:!0,chooseLabel:"Browse"}),s(m,{message:(ae=a.value)==null?void 0:ae.residenceCard},null,8,["message"])])]),l("div",el,[e[37]||(e[37]=l("div",{class:"flex items-start pt-3 w-1/2"},[l("label",{for:"driveLicense"},"Drive license")],-1)),l("div",null,[s(n(oe),{mode:"basic",severity:"secondary",name:"driveLicense[]",url:"/api/upload",accept:"image/*",maxFileSize:1e6,onUpload:U,auto:!0,chooseLabel:"Browse"}),s(m,{message:(te=a.value)==null?void 0:te.driveLicense},null,8,["message"])])]),l("div",ll,[e[38]||(e[38]=l("div",{class:"flex items-start pt-3 w-1/2"},[l("label",{for:"points"},"Points")],-1)),l("div",sl,[s(n(y),{invalid:!!((ie=a.value)!=null&&ie.points),modelValue:i.value.points,"onUpdate:modelValue":e[22]||(e[22]=t=>i.value.points=t),onInput:e[23]||(e[23]=t=>u("points")),type:"number",id:"points",class:"w-full"},null,8,["invalid","modelValue"]),s(m,{message:(ne=a.value)==null?void 0:ne.points},null,8,["message"])])]),l("div",al,[s(q,{label:"Cancel",onClick:z,outlined:"",severity:"secondary"}),s(q,{label:"Save",type:"submit",severity:"primary",autofocus:""})])],544)]}),_:1},8,["header","visible"]))}},il={class:"page page-clients"},nl={class:"page-content"},ol={class:"clients-table"},dl={class:"module module-with-scroller module-with-scroller-lg p-1"},rl={class:"page-content-top mb-3 pb-1 flex gap-2 flex-wrap"},ul={class:"text-muted"},vl={class:"flex gap-2"},ml={class:"page-content-bottom"},wl={__name:"ClientsView",setup(V){const c=p(""),g=p(!1),C=p(!1),x=p(null),f=p([]),i=p([]),S=p(8),I=p(0),H=p(0),a=p(!0),u=({page:o,rows:r})=>{H.value=o,S.value=r,$()},Z=o=>{c.value=o,$()},z=o=>{x.value=o,C.value=!0},U=()=>{x.value=null,C.value=!1},v=()=>{f!=null&&f.value.length?M():B(x.value),U()},e=o=>{x.value=o,g.value=!0},h=()=>{g.value=!1},E=o=>{F.upsertClient(o),h(),$()},M=()=>{const o=f.value.map(r=>r.id);F.deleteClients(o),f.value=[],$()},B=o=>{const{id:r}=o;F.deleteClient(r),$()},$=async()=>{a.value=!0;try{const o=await F.getClients({expression:c==null?void 0:c.value},null,H.value,S.value);if(!o.ok)throw new Error("Failed to load data");i.value=o.data,I.value=o.total}catch(o){o.value=o.message}finally{a.value=!1}};return ce(()=>{$()}),(o,r)=>(L(),j("div",il,[s(fe,{title:"Clients"}),l("div",nl,[l("div",ol,[s(n(Ce),null,{content:D(()=>[l("div",dl,[l("div",rl,[s(ge,{variant:"dark",placeholder:"Search for client",onSearchInput:Z,filter:c.value},null,8,["filter"]),f.value.length?(L(),k(q,{key:0,severity:"secondary",label:"Delete selected",size:"small",class:"ml-auto delete-selected-clients",onClick:z})):P("",!0),s(q,{label:"Add client",severity:"primary",size:"small",onClick:r[0]||(r[0]=d=>e()),class:ye([f.value.length?"ml-0":"ml-auto","add-new-client"])},null,8,["class"])]),c.value.length&&!i.value.length?(L(),k(n($e),{key:0,severity:"secondary",class:"w-full mt-5 mb-5"},{default:D(()=>r[2]||(r[2]=[b("No clients were found matching your criteria.")])),_:1})):(L(),k(n(we),{key:1,class:"outlined",scrollable:"",selection:f.value,"onUpdate:selection":r[1]||(r[1]=d=>f.value=d),value:i.value,loading:a.value,tableStyle:"min-width: 50rem"},{default:D(()=>[s(n(N),{selectionMode:"multiple",headerStyle:"width: 3rem"}),s(n(N),{field:"fullname",sortable:"",header:"Client"},{body:D(d=>[l("div",null,T(d.data.fullname),1),l("span",ul,T(d.data.email),1)]),_:1}),s(n(N),{field:"phone",sortable:"",header:"Phone"}),s(n(N),{field:"addressLine1",sortable:"",header:"Address"}),s(n(N),{header:"Documents"},{body:D(d=>{var _,A;return[(_=d.data)!=null&&_.residenceCard?(L(),k(re,{key:0,class:"my-1","card-type":"residenceCard",firstName:d.data.firstName},null,8,["firstName"])):P("",!0),(A=d.data)!=null&&A.driveLicense?(L(),k(re,{key:1,class:"my-1","card-type":"driveLicense",firstName:d.data.firstName},null,8,["firstName"])):P("",!0)]}),_:1}),s(n(N),{field:"points",sortable:"",header:"Points"}),s(n(N),{header:"Actions"},{body:D(d=>[l("div",vl,[s(q,{size:"small",label:"Edit",outlined:"",onClick:_=>e(d.data)},null,8,["onClick"]),s(q,{size:"small",label:"Delete",outlined:"",onClick:_=>z(d.data)},null,8,["onClick"])])]),_:1})]),_:1},8,["selection","value","loading"])),l("div",ml,[s(Le,{limit:S.value,total:I.value,onPageChange:u},null,8,["limit","total"])])])]),_:1})])]),s(be,{showDialog:C.value,onApplyConfirmation:v,onHide:U},null,8,["showDialog"]),s(tl,{client:x.value,showDialog:g.value,onSave:E,onHide:h},null,8,["client","showDialog"])]))}};export{wl as default};
